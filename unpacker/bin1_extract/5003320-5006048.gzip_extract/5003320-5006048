(function(){apps.ICCHlp={};var a=apps.ICCHlp;a.statusSchema=[{name:"ut:State"},{name:"ut:ErrorDetails",type:"struct",schema:[{name:"ut:Type"}]},{name:"ut:AgeInSeconds"}];a.urls={jobUrl:"/Utilities/ICCJob",jobStatusUrl:"/UtilitiesManifest.xml/ICCStatus"};a.isSupported=true;a.errorCode="";a.isAvailable=function(b){if(b!=undefined){a.isSupported=b}return a.isSupported};a.errorTable={networkNotConnected:{category:"INTERNET_NETWORK",errMsg:null},ipNotRoutable:{category:"INTERNET_NETWORK",errMsg:null},gatewayNotConfigured:{category:"DNS_GATEWAY",errMsg:null},gatewayNotReachable:{category:"DNS_GATEWAY",errMsg:null},dnsNotConfigured:{category:"DNS_GATEWAY",errMsg:null},dnsNotReachable:{category:"DNS_GATEWAY",errMsg:null},dnsNotResolved:{category:"DNS_GATEWAY",errMsg:null},proxyNotConfigured:{category:"PROXY",errMsg:null},proxyConnectionFailed:{category:"PROXY",errMsg:null},proxyRequiresAuthentication:{category:"PROXY",errMsg:null},proxyCredentialsIncorrect:{category:"PROXY",errMsg:null},proxyURLResolutionFailed:{category:"PROXY",errMsg:null},serverConnectionFailed:{category:"INTERNET_NETWORK",errMsg:null},checkAttemptsExceeded:{category:"SERVER",errMsg:null}};a.categoryErrorTable={INTERNET_NETWORK:{generalErrMsg:te.loc("L@S#4578")+"<br><br>"+te.loc("L@S#4504")+" "+te.loc("L@S#4505")+"<br><br>"+te.locInfoMsg("L@S#3411","L@S#4573")},DNS_GATEWAY:{generalErrMsg:te.loc("L@S#4578")+"<br><br>"+te.loc("L@S#4574")+" "+te.loc("L@S#4505")+"<br><br>"+te.locInfoMsg("L@S#3411","L@S#4573")},PROXY:{generalErrMsg:te.loc("L@S#4578")+"<br><br>"+te.loc("L@S#4066")+"<br><br>"+te.locInfoMsg("L@S#3411","L@S#4573")},SERVER:{generalErrMsg:te.loc("L@S#4575")+" "+te.loc("L@S#4576")+"<br><br>"+te.loc("L@S#4577")+"<br><br>"+te.loc("L@S#4508")}};a.getErrorCategory=function(b){return apps.ICCHlp.errorTable[b].category};a.getErrorMsg=function(b){var c=apps.ICCHlp.errorTable[b].errMsg||apps.ICCHlp.categoryErrorTable[apps.ICCHlp.getErrorCategory(b)].generalErrMsg;return c};a.obj=function(b){if($.hlp.ledm.hasTree("UtilitiesManifest.xml")){this.appsData={pageFrag:b,printObj:new apps.InternalPrintDO(b)};apps.ICCHlp.isAvailable(true)}else{apps.ICCHlp.isAvailable(false)}};a.obj.prototype.getCapObj=function(){return this.capJsObj};a.obj.prototype.getJsObj=function(){return this.dynJsObj};a.obj.prototype.startDiagnostic=function(b){$.ajax({type:"POST",url:a.urls.jobUrl,processData:false,success:function(c,d){},error:function(d,f,e){var c=[{}];c=[{pgmErr:true,pgmStatus:+(d.status)}];c.hasErr=true;switch(d.status){case 500:default:break}b(c)},complete:function(c,d){if(d=="success"){b({hasErr:false})}}})};a.obj.prototype.getICCInfo=function(d,b){var c=this;var e=180;c.startDiagnostic(function(g){c.iccErrCode="";if(g.hasErr){b({iccErrorCode:""})}else{var h=0;function f(){c.checkStatus(d,function(i){if(i.hasErr){b({iccErrorCode:""})}else{if(c.isCheckCompleted()){a.errorCode=c.getErrorCode();b({iccErrorCode:c.getErrorCode()})}else{setTimeout(function(){h++;if(h>e){b({iccErrorCode:""})}else{f()}},1000)}}})}f()}})};a.obj.prototype.checkStatus=function(d,b){var c=this;d.get({file:a.urls.jobStatusUrl,dataType:"ledm"},function(e){if(e.hasErr){b(e);return}var f=d.getLedmXml(a.urls.jobStatusUrl);c.dynJsObj=te.sXmlParser.parse(f,a.statusSchema);if(c.dynJsObj.ErrorDetails){apps.ICCHlp.errorCode=c.dynJsObj.ErrorDetails.Type}b(e)})};a.obj.prototype.isCheckCompleted=function(){return(this.getJsObj().State=="checkCompleted")};a.obj.prototype.isCheckInProgress=function(){return(this.getJsObj().State=="checkInProgress")};a.obj.prototype.getErrorCode=function(){if(this.getJsObj()){return this.getJsObj().ErrorDetails.Type}else{return apps.ICCHlp.errorCode}};a.obj.prototype.isConnected=function(){return(this.getJsObj().ErrorDetails.Type=="connected")};a.printReport=function(e,d){var c=$.nopfn;var f="";if(d){if(d.complete){c=d.complete}if(d.title){f=d.title}}var b={complete:c,jobId:"webAccessReport",header:f};te.startPrintJobAndWait(e,b)};a.showDefaultNetworkErrorScrn=function(d,c){var b="Internet";if(c&&c.errType){b=c.errType}if(b=="Server"){c.btnList=[{text:"L@S#3117",cmd:"retry_btn",isActionBtn:true},{text:"L@S#0002",cmd:"cancel_btn"}];c.errMsg=te.loc("L@S#4506")+"<br><br>"+te.loc("L@S#4507")+" "+te.loc("L@S#4508")}else{c.btnList=[{text:"L@S#4067",cmd:"enter_proxy_btn",isActionBtn:true},{text:"L@S#3117",cmd:"retry_btn"},{text:"L@S#0002",cmd:"cancel_btn"}];c.errMsg=te.loc("L@S#4503")+"<br><br>"+te.loc("L@S#4504")+" "+te.loc("L@S#4505")+"<br><br>"+te.loc("L@S#4066")}apps.ICCHlp.showConnectionErrorScrn(d,c)};a.showICCNetworkErrorScrn=function(c,b){var d=apps.ICCHlp.getErrorCategory(b.iccErrorCode);switch(d){case"DNS_GATEWAY":case"INTERNET_NETWORK":b.btnList=[{text:"L@S#4579",cmd:"print_report_btn",isActionBtn:false},{text:"L@S#3117",cmd:"retry_btn",isActionBtn:true},{text:"L@S#0002",cmd:"cancel_btn"}];break;case"PROXY":b.btnList=[{text:"L@S#4579",cmd:"print_report_btn",isActionBtn:false},{text:"L@S#4067",cmd:"enter_proxy_btn",isActionBtn:true},{text:"L@S#3117",cmd:"retry_btn"},{text:"L@S#0002",cmd:"cancel_btn"}];break;case"SERVER":default:b.btnList=[{text:"L@S#3117",cmd:"retry_btn",isActionBtn:true},{text:"L@S#0002",cmd:"cancel_btn"}];break}b.errMsg=apps.ICCHlp.getErrorMsg(b.iccErrorCode);apps.ICCHlp.showConnectionErrorScrn(c,b)};a.showConnectionErrorScrn=function(g,f){var e=this;var d=[{}];var h=$.nopfn;var c=$.nopfn;if(f){h=f.cancelCallback;c=f.retryCallback}var b={btnList:f.btnList,header:f.title,errMsg:f.errMsg,showErrContMsg:false,complete:function(i){switch(i){case"print_report_btn":apps.ICCHlp.printReport(g,{title:f.title,complete:function(j){gui.showResultScrn(g,j,{header:f.header,msg:f.resultMsg||"L@S#2399",errMsgs:te.simplePrintJobErrMsgs,complete:function(){setTimeout(function(){apps.ICCHlp.showConnectionErrorScrn(g,f)},0);return true}})}});break;case"enter_proxy_btn":apps.ICCHlp.isResumePage(false);apps.ICCHlp.isProxyInWorkflow(true);apps.ICCHlp.redirectToProxyPage(g);break;case"retry_btn":if(apps.ICCHlp.pausedPage()==f.pendingPgmName){apps.ICCHlp.isResumePage(true)}if(c){c()}else{apps.ICCHlp.redirectToProxyPage(g,{pendingPgmName:f.pendingPgmName})}break;case"cancel_btn":apps.ICCHlp.isResumePage(false);if(h==$.nopfn){apps.ICCHlp.redirectToProxyPage(g,{pendingPgmName:f.pendingPgmName})}else{h()}break;default:break}}};d.hasErr=true;gui.showResultScrn(g,d,b)};a.handleConnectionErrors=function(d,c){var b="Internet";if(c){if(!c.icc){c.icc=new apps.ICCHlp.obj(d)}if(!c.netAppsObj){c.netAppsObj=new apps.NetAppsDO(d)}if(c.pendingPgmName){if(c.pendingPgmName=="pgWebServicesSummary"){c.pendingPgmName="pgWebServicesSetup"}apps.ICCHlp.pausedPage(c.pendingPgmName)}if(c.errType){if(apps.ICCHlp.isAvailable()){c.iccErrorCode=c.icc.getErrorCode()}b=c.errType}}if(b=="Internet"&&c.iccErrorCode){if(c.icc.isConnected()){c.errType=b="Server"}else{if(apps.ICCHlp.getErrorCategory(c.iccErrorCode)=="PROXY"){b="Proxy"}}}switch(b){case"Internet":if(apps.ICCHlp.isAvailable()){if(c.iccErrorCode){apps.ICCHlp.showICCNetworkErrorScrn(d,c);return}}apps.ICCHlp.showDefaultNetworkErrorScrn(d,c);break;case"Proxy":if(apps.ICCHlp.isAvailable()){if(!c.iccErrorCode){c.iccErrorCode="proxyNotConfigured"}if(c.netAppsObj.getWpadConfig()&&c.netAppsObj.isWpadDetected()){setTimeout(function(){apps.ICCHlp.handleWPAD(d,c)},0);return}apps.ICCHlp.showICCNetworkErrorScrn(d,c);return}apps.ICCHlp.showDefaultNetworkErrorScrn(d,c);break;case"Server":default:apps.ICCHlp.showDefaultNetworkErrorScrn(d,c);break}};a.handleWPAD=function(d,c){if(c.netAppsObj.isWpadInUse()){gui.YNDialogBox.show({title:te.loc("L@S#4665"),customBtnText:["L@S#0005"],contents:te.loc("L@S#4666")+" "+te.loc("L@S#4667")+"<p>"+te.locInfoMsg("L@S#3224","L@S#4668")+"</p>"},function(e){apps.ICCHlp.redirectToProxyPage(d)})}else{var b=[{}];b.hasErr=true;gui.showResultScrn(d,b,{showErrContMsg:false,errMsg:"<h2>"+te.loc("L@S#4664")+"</h2><p>"+te.loc("L@S#4631")+" "+te.loc("L@S#4632")+"</p><p>"+te.loc("L@S#4042")+": "+c.netAppsObj.getWpadUri()+"<br>"+te.loc("L@S#4043")+": "+c.netAppsObj.getWpadPort()+"</p>",showStatusImg:false,btnList:[{text:"L@S#0071",cmd:"Yes"},{text:"L@S#0072",cmd:"No"}],complete:function(e){if(e=="Yes"){te.updateDataObjs({updateObjs:[{dataObj:c.netAppsObj,jsObj:{ProxyConfig:{ProxyMode:"manual",ProxySupport:"on",ResourceURI:c.netAppsObj.getWpadUri(),Port:c.netAppsObj.getWpadPort()}}}],pageFrag:d,progressIntf:d,complete:function(f){if(!f.hasErr){gui.showVeil(true);c.netAppsObj.refreshDyn(d,function(g){gui.showVeil(false);if(!g.hasErr){if(c.retryCallback){c.retryCallback()}else{apps.ICCHlp.redirectToProxyPage(d,{pendingPgmName:c.pendingPgmName})}}});return false}}})}else{apps.ICCHlp.redirectToProxyPage(d)}}})}};a.redirectToProxyPage=function(d,c){var b="ProxySettingsPage";apps.ICCHlp.isProxyInWorkflow(true);c=$.extend({pendingPgmName:null},c);if(c.pendingPgmName){b=c.pendingPgmName}else{if(d.pgmName=="pgProductUpdateStandalone"||d.pgmName=="pgProductUpdateNoWebServices"||d.pgmName=="pgProductUpdateProxySetting"){b="pgProductUpdateProxySetting"}else{b="pgWebServicesProxySetting"}}$.browseHistory.clickALink(b)};a.isResumePage=function(b){if(b!=undefined){te.cookie.set("isResumePage",b,1)}else{var c=te.cookie.getVal("isResumePage");if(c!=""){return c}else{return false}}};a.pausedPage=function(b){if(b!=undefined){te.cookie.set("pausedPageName",b,1)}else{return te.cookie.getVal("pausedPageName")}};a.isProxyInWorkflow=function(b){if(b!=undefined){te.cookie.set("isProxyFlow",b,1)}else{var c=te.cookie.getVal("isProxyFlow");if(c!=""){return c}else{return false}}}})();