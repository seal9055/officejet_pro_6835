if(printInfo==undefined){var printInfo=new Object()}(function(){var a="/webApps/PrintInfo/printInfo.htf";printInfo.getServerConnectionStatus=function(c){var e=false;function b(){return e}gui.showProgressScrn(this.appData.thisPageFrag,{isDone:b,header:"L@S#4077",msg:"L@S#3120",complete:c});var d=function(){e=true};this.appData.ePrintObj.reloadLedmXml(d)};printInfo.isServerConnected=function(){return(this.appData.ePrintObj.getConnectionStatus()==="connected")};printInfo.sendPrintInfoJob=function(h,d){var c=false;var k=null;var i=this;var j=false;var e=$.noop;var b=[{}];if(d){if(d.isBackground){j=d.isBackground}if(d.complete){e=d.complete}if(d.errMsg){b.errMsg=d.errMsg;b.showErrContMsg=false;b.showErrCode=false}}if(!j){gui.showProgressScrn(h,{isDone:function(){return c},header:"L@S#4077",msg:te.loc("L@S#3121")+"...",complete:function(){g()}})}h.put({op:"post",file:"/ePrint/InstructionPage"},f);function f(l){c=true;k=l}function g(){switch(k[0].pgmStatus){case 200:case 202:if(e!=$.noop){e(k)}else{h.reload()}break;case 403:gui.OKDialogBox.show({title:"L@S#4077",contents:te.loc("L@S#3149")+te.loc("L@S#3150")+gui.emitHtml("p",null,te.loc("L@S#3151"))},function(){setTimeout(function(){e(k)},0)});break;case 503:var l=[{}];l.hasErr=true;b={errMsg:te.loc("L@S#3118")+"<br><br>"+te.loc("L@S#3119"),showErrContMsg:false,btnList:[{text:"L@S#3117",cmd:"retry_btn"},{text:"L@S#0002",cmd:"cancel_btn"}],complete:function(m){switch(m){case"retry_btn":$("#pI-main").hide();printInfo.handleApplyBtn(h);break;case"cancel_btn":h.reload();return true;break;default:h.reload();break}}};gui.showResultScrn(h,l,b);break;default:b.complete=function(){e(k)};gui.showResultScrn(h,k,b);break}}};printInfo.handleApplyBtn=function(b){printInfo.sendPrintInfoJob(b)};printInfo.checkClaimStatus=function(f){var e=this;var d;var h;var b=false;var g=0;var c=false;gui.showProgressScrn(e,{minTimeout:1000,isDone:function(){return c},header:"L@S#4004",msg:te.loc("L@S#3884"),complete:f});function i(){printInfo.appData.ePrintObj.refreshClaimStatus(function(){g++;d=printInfo.appData.ePrintObj.getClaimStatus();if(b){console.log("check initiated");if(d!="idle"&&d!="check"&&d!="checking"||g>20){c=true;return}}else{if(d=="check"||d=="checking"||d!=h){b=true}else{if(g>2){console.log("warning: check or checking status not detected!");c=true;return}}}setTimeout(function(){i()},100)})}d=printInfo.appData.ePrintObj.getClaimStatus();h=d;if(d=="check"||d=="checking"){i()}else{printInfo.appData.ePrintObj.startClaimStatusCheck(function(j){if(j.hasErr){c=true}else{i()}})}};printInfo.onLoad=function(){var b=this;printInfo.appData={thisPageFrag:b,ePrintObj:new apps.cloudPrint.cloudprintObj(b)};if(printInfo.appData.ePrintObj.getEPrintAdminStatus()=="disabled"){printInfo.checkClaimStatus(function(c){if(printInfo.appData.ePrintObj.isUnClaimed()){printInfo.loadPage(b)}else{gui.showDisabledScrn(b,{errMsg:te.loc("L@S#4219")+"<br><br>"+te.loc("L@S#3152")})}})}else{printInfo.loadPage(b)}};printInfo.loadPage=function(d,c){printInfo.appData={thisPageFrag:d,ePrintObj:new apps.cloudPrint.cloudprintObj(d)};if(c){$("#"+d.pgmDivId).html(te.includeSubPage(a))}var b=new gui.Button({isActionBtn:true,text:"L@S#4077",onClick:function(){printInfo.handleApplyBtn(printInfo.appData.thisPageFrag)}});b.create("printInfoBtn");if(printInfo.appData.ePrintObj.isSipsAvailable()){if(printInfo.appData.ePrintObj.hasPrintables()){$("#pI-summaryWithPrintables").show()}else{$("#pI-summary").show()}}else{$("#pI-summaryEPrintOnly").show()}return};printInfo.onUnLoad=function(){};if(apps.PrintInfo){apps.PrintInfo.pgPrintInfo.loadPage=printInfo.loadPage;apps.PrintInfo.pgPrintInfo.sendPrintInfoJob=printInfo.sendPrintInfoJob}})();